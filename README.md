# 双模式工业温湿度监控上位机

一款支持“独立运行”与“MES接入”双模式的工业级温湿度监控系统，专为电子元器件工厂（SMT贴片车间）、医药/食品加工厂（无菌车间/冷库）设计，解决传统人工巡检滞后、数据难追溯、MES对接适配性差等问题。


## 项目背景

针对不同规模工厂的环境监控需求：
- 小型工厂：无MES系统，需本地独立完成数据采集、存储、告警
- 中型工厂：需与MES系统联动，实现数据同步与告警互通

系统通过双模式设计，满足多样化场景需求，同时保证数据实时性、可追溯性与系统稳定性。


## 核心功能

| 功能模块       | 独立模式                                                                 | MES接入模式（含独立模式全功能）                                          |
|----------------|--------------------------------------------------------------------------|-------------------------------------------------------------------------|
| **设备通信**   | 自动扫描多串口、配置波特率/数据位等参数、显示连接状态                     | 继承独立模式功能 + MES接口地址/工厂编码配置                              |
| **数据采集**   | 1秒/次采集温湿度/电压、过滤无效值（如温度>100℃或<-40℃）                 | 继承独立模式功能 + 自动转换为MES要求的JSON格式、标记上传状态             |
| **告警功能**   | 自定义阈值、声光告警（弹窗+提示音）、异常数据标记                         | 继承独立模式功能 + 异常数据同步至MES、回显MES接收状态                   |
| **数据存储**   | 本地SQLite存储、时间范围查询、Excel导出（含采集时间/温湿度/是否异常）     | 继承独立模式功能 + 断网缓存待上传数据、网络恢复后自动同步               |
| **状态监控**   | 串口连接指示灯、实时数据仪表盘（数字+趋势图）、采集频率显示               | 继承独立模式功能 + MES连接状态指示灯、数据上传成功率显示（如99.9%）     |


## 技术栈

| 技术类别       | 选型工具/框架               | 说明                                  |
|----------------|----------------------------|---------------------------------------|
| 开发语言       | C#                         | 成熟的工业上位机开发语言              |
| 框架版本       | .NET Core 6.0              | 跨平台支持，性能优于传统.NET Framework |
| UI框架         | WPF + Prism                | 支持自定义控件与MVVM分层架构          |
| 串口通信       | System.IO.Ports            | .NET内置类库，简化串口操作            |
| 数据可视化     | LiveCharts                 | 轻量级图表库，支持实时趋势图更新      |
| 本地数据库     | SQLite                     | 无需服务的文件数据库，适合单机场景    |
| ORM框架        | EF Core                    | 简化数据库操作，支持Code First        |
| MES对接        | HttpClient + Newtonsoft.Json | 支持REST API调用与JSON格式转换        |
| 日志记录       | Serilog                    | 按级别记录日志，便于排查对接问题      |
| Excel导出      | EPPlus                     | 快速导出数据至Excel，兼容报表需求      |


## 架构设计

采用MVVM分层架构，解耦业务逻辑与UI展示：

```
DualModeMonitorSystem/
├─ Models/           // 数据模型（映射数据库表与业务实体）
├─ ViewModels/       // 视图模型（处理业务逻辑，实现数据绑定）
├─ Views/            // 视图层（UI界面，XAML文件）
├─ Services/         // 核心服务（串口通信、数据采集、数据库操作等）
├─ MESServices/      // MES对接服务（API调用、重试与缓存）
└─ Helpers/          // 工具类（数据校验、告警处理、格式转换等）
```

核心通信逻辑：
- 视图与视图模型：通过WPF数据绑定实现双向通信
- 跨视图模型通信：基于Prism事件聚合器传递事件
- 服务与视图模型：通过依赖注入解耦，便于测试与扩展


## 快速使用

1. **系统启动**：自动加载配置，默认进入上次运行模式
2. **设备配置**：在“串口配置页”选择串口号，设置波特率等参数，启动通信
3. **模式切换**：在“MES配置页”选择运行模式（独立/MES接入），无需重启
4. **数据查看**：在“实时监控页”查看仪表盘与趋势图，在“历史数据页”查询导出
5. **MES对接**（仅MES模式）：配置接口地址/工厂编码，系统自动同步数据与告警

## 许可证

[MIT](LICENSE)
